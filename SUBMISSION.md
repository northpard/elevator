## Elevator Project — 제출 문서

작성일: 2025-11-13

간략 설명
- 보드: Arduino Uno
- 층수: 3층(1,2,3)
- 가용 부품: 각 층 호출 버튼(푸시버튼) + 호출 표시 LED(RED), 층 위치 표시 LED(GREEN), 층간 이동 표시 LED(YELLOW x2), 저항 등

## 1. 구현된 기능 (최소 요구 기능)

- 버튼 호출: 각 층의 외부 호출 버튼을 누르면 해당 호출이 등록되고 버튼 옆 RED LED가 켜집니다.
- 호출 표시 LED 동작: 도착 시 해당 호출은 소거되고 버튼 LED는 꺼집니다.
- 이동 애니메이션: 층간 이동 중 YELLOW LED 2개가 순차적으로 켜져 "이동 중" 애니메이션을 표시합니다.
- 상태 LED: GREEN LED는 시스템 동작 상태(전원/정상)를 표시합니다n
- 스케줄링 정책: SCAN 계열(같은 방향 우선) — 현재 엘리베이터가 올라가고 있으면 위쪽 호출을 우선 처리합니다.

 - 이동 애니메이션: 층간 이동 중 YELLOW LED 2개가 순차적으로 켜져 "이동 중" 애니메이션을 표시합니다.
 - (참고) 별도 STATUS LED는 하드웨어에 연결되어 있지 않습니다. 시스템 상태는 개별 `FLOOR_LED`(층 표시 LED)의 동작으로 확인할 수 있습니다.
 - 스케줄링 정책: SCAN 계열(같은 방향 우선) — 현재 엘리베이터가 올라가고 있으면 위쪽 호출을 우선 처리합니다.
- 호출 취소: 호출된 버튼을 길게(>=1초) 누르면 호출이 취소됩니다.
- 취소 보호시간: 취소 직후(500ms) 동일 버튼의 재등록을 차단하여 실수 재등록을 방지합니다.
- 취소 UX: 취소가 성공하면 버튼 LED가 비차단 방식으로 빠르게 2회 깜빡이고 꺼집니다.

## 2. 미구현(선택) 기능 / 확장 제안

우선순위 추천 (높음 → 낮음)

1. 내부(캐빈) 버튼 추가: 내부에서 특정 층을 선택할 수 있는 버튼과 해당 버튼의 LED.
2. 도어 시뮬레이션: 도어 열림/닫힘 상태를 모의하고 도어 열림 중 이동 금지, 도어 열림 시간 설정.
3. 방향 표시(LED): 현재 이동 방향을 표시(위/아래 화살표 LED).
4. EEPROM에 호출 기록 저장: 전원 재투입 시 마지막 상태 복원.
5. 긴급 정지 버튼: 모든 호출 취소 및 즉시 정지(안전 구현 시 하드웨어 보호 필요).

각 항목에 대한 간단한 계약(Inputs/Outputs/예외)
- 내부 버튼: 입력: 내부 버튼 신호, 출력: 내부 요청 플래그. 예외: 동일 층 재요청 무시.
- 도어 시뮬레이션: 입력: 도착 이벤트, 출력: 도어 상태 LED/논리 블록(열림/닫힘). 예외: 도어 열림 동안 이동 시도 차단.

## 3. 순서도 (Flowchart)

다음은 현재 펌웨어의 주요 흐름을 표현한 순서도입니다(Mermaid). 프로젝트 README나 제출 문서 뷰어가 Mermaid를 지원하면 다이어그램으로 확인 가능합니다.

```mermaid
flowchart TD
  A[시작: setup()] --> B[주기: loop() 실행]
  B --> C[버튼 읽기 및 디바운스]
  C --> D{버튼 상태}
  D -->|짧은 누름| E[요청 등록 -> 요청 LED ON]
  D -->|긴 누름| F[요청 취소 -> 취소 피드백(깜빡임) -> 요청 LED OFF]
  E --> G{이동중?}
  G -->|아니오| H[대상 스케줄링 (SCAN 우선)]
  H --> I[이동 시작 -> between-floor 애니메이션]
  I --> J[도착: 현재층 갱신, 요청 소거, 층 LED 갱신]
  J --> B
  G -->|예| I

  style F fill:#ffe6e6,stroke:#cc0000
  style I fill:#fff5cc,stroke:#e6b800
  style J fill:#e6ffe6,stroke:#00a800
```

(텍스트 기반 순서도) 요약
- loop(): 버튼 스캔 -> 요청/취소 처리 -> 스케줄러로 다음 목표 선정 -> 이동 애니메이션 -> 도착 시 요청 소거

## 4. 테스트 케이스 및 결과

테스트는 개발 환경(로직 시뮬레이션)에서 수동으로 수행했습니다. 아래는 주요 시나리오와 실제 동작 결과입니다.

| # | 테스트 설명 | 예상 결과 | 실제 결과 | 상태 |
|---:|---|---|---|---|
| 1 | 층1 호출 버튼(짧게) 누름 | 층1 요청 LED ON, 엘리베이터가 층1로 이동 후 요청 LED OFF | 동일 | PASS |
| 2 | 층3에서 호출, 현재 엘리베이터가 올라가는 중 추가 위쪽 호출 | 같은 방향 우선으로 처리 (위쪽 호출 먼저) | 동일 | PASS |
| 3 | 등록된 호출에서 긴 누름(>=1s) 취소 | 버튼 LED가 2회 깜빡이고 호출이 취소됨, 재등록이 500ms 동안 차단됨 | 동일 | PASS |
| 4 | 도착 후 버튼 LED 소거 | 요청 소거 시 버튼 LED OFF | 동일 | PASS |
| 5 | 이동 중 애니메이션 | 층간 YELLOW LED 2개가 순차적으로 켜짐 | 동일 | PASS |

테스트 메모
- 위의 결과는 실제 하드웨어에서의 직접 관찰을 상정한 수동 테스트 결과입니다. 실제 하드웨어(브레드보드 + Uno) 연결 시 전기적 잡음, 버튼 바운스, 전원 문제 등으로 추가 튜닝(디바운스 값 등)이 필요할 수 있습니다.

## 5. 핀 맵 (참고)

- BTN_PINS: 호출 버튼 (예: D2, D3, D4)
- BTN_LED: 호출 표시 RED LED (예: D5, D6, D7)
- FLOOR_LED: 층 위치 표시 GREEN LED (예: D8, D9, D10)
- BETWEEN_LED: 층간 이동 표시 YELLOW LED (예: D11, D12)

- (참고) 별도 `STATUS_LED` 핀은 사용하지 않음 — 시스템 상태는 `FLOOR_LED`로 대체됩니다.

실제 핀 번호는 `elevator.ino` 상단의 상수 매핑을 확인하세요.

## 6. 실행/검증 방법 (간단)

1. 하드웨어 연결: README.md의 핀맵과 브레드보드 배선을 참고해 부품을 연결합니다.
2. 스케치 업로드: `elevator.ino`를 Arduino IDE에서 열어 보드를 Uno로 설정하고 업로드합니다.
3. 동작 확인: 각 층 버튼을 눌러 LED/이동 동작을 관찰합니다. 긴 누름(>=1s)으로 호출 취소를 테스트합니다.

## 7. 제출물 목록

- `elevator.ino` — 펌웨어 소스
- `README.md` — 프로젝트 요약 및 핀맵
- `SUBMISSION.md` — (이 문서)
- 이미지 파일들: `elevator_instruction.png`, `elevator_arduino.png`, `elevator_requirement.png` (회로/요구사항 관련 스크린샷)

## 8. 다음 단계(권장)

1. 내부(캐빈) 버튼 및 도어 시뮬레이션 구현 (우선순위 1·2)
2. 실제 브레드보드에서 동작 검증 및 버튼 하드웨어 디바운스/풀업 조정
3. TinkerCAD 회로 재구성 및 시뮬레이션 링크/스크린샷을 README에 첨부

---
파일 위치: `/home/jm/dev_ws/arduino/src/elevator/SUBMISSION.md`

원하면 이 문서를 README로 통합하거나 PDF로 출력해서 제출 자료(학과/과제 제출용)로 변환해 드리겠습니다.
